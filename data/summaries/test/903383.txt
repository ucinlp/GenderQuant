Prince Charming now performs inside a stage in a bar, vowing that he'll become King of Far, Far Away. Meanwhile, King Harold is dying and his ogre son-in-law Shrek and daughter Princess Fiona are next in line to be King and Queen of Far Far Away. Shrek, who is having considerable difficulty serving as Regent during the King's medical leave, insists that an ogre as king is a bad idea and that there has to be someone else for the job. Before dying, Harold tells Shrek that there is another heir: his nephew, Arthur Pendragon. Meanwhile, Prince Charming has gone to the Poison Apple tavern where he encounters a variety of fairy tale villains consisting of Captain Hook, the Evil Queen, Rumpelstiltskin, a Cyclops, the Headless Horseman, the Puppet Master, assorted outlaws, black knights, pirates, malevolent trees, evil Dwarves, and wicked witches. Although they initially despise Prince Charming, he persuades them to fight for their "happily ever after" after reviewing how they were robbed of theirs like he was robbed of his. Meanwhile Shrek, Donkey and Puss in Boots set out to retrieve Arthur, as they're sailing away, Fiona announces to Shrek that she is pregnant. Shrek says that he is going to like it until he begins thinking of what being a father would bring to him. The trio journey to Worcestershire Academy, an elite boarding school, where they discover that Arthur  is a scrawny 16-year old underachiever picked on by everyone. At the school pep rally, Shrek tells Artie he's going to be king of Far Far Away. Artie is excited until Donkey and Puss inadvertently scare him by talking about the responsibilities of being king while they're sailing home. Panicked, Artie tries to take control of the ship and crashes it on an island where they meet Artie's retired wizard teacher, Merlin. Charming and the other villains invade the kingdom and attack the castle, but Wolfie, Pinocchio, Gingie, the Three Little Pigs, and the Blind Mice stall them enough long enough for Fiona and her mother Queen Lilian to try escaping along with Snow White, Rapunzel, Cinderella, Sleeping Beauty and Doris the Ugly Stepsister. However the ladies are captured when Rapunzel betrays them because she is in love with Charming. Captain Hook and his pirates track Shrek and company to Merlin's island, where they attempt to capture Shrek and kill the others. Shrek and Artie send the villains running, but not before Hook mentions Charming and the takeover of Far Far Away. Concerned for his wife and future children, Shrek urges Artie to return to the safety of Worcestershire. However, Artie cons Merlin into coming out of retirement long enough to use his magic to send them all to Far Far Away; the spell works, but accidentally causes Puss and Donkey to switch bodies. They find Charming bent on revenge against Shrek for "stealing" his "happily ever after," and learn that he plans to kill Shrek in a play that night. Charming's men arrive shortly, but Artie tricks the knights into not taking them into custody. They break into the castle during rehearsals for the play. In Charming's dressing room, Shrek bursts in but Charming summons his men, who take the four captive. Charming prepares to kill Artie, believing he's the next king. To save Artie's life, Shrek tells Charming that Artie was just a pawn to take his place as King of Far Far Away. Charming believes Shrek and decides not to kill Artie, who runs away. Donkey and Puss are imprisoned with Fiona and the princesses, where Fiona grows frustrated with their lack of initiative. Queen Lilian smashes the stone wall of the prison by head butting the walls. While the princesses launch a rescue mission for Shrek, Donkey and Puss free Gingy, Pinocchio, the wolf and pigs, Dragon, and Donkey's children. They encounter Artie, and Puss and Donkey explain to him that Shrek lied so Charming wouldn't kill him. Charming stages a musical in which he rescues Rapunzel. The chained Shrek wins the audience by ridiculing Charming. Just as Charming is about to kill Shrek, Princess Fiona along with Puss, Donkey, the princesses and the fairy tale characters confront the villains. However, the villains regain control. Artie eventually arrives and convinces the villains to give up their evil ways. Charming, furious at being thwarted, lunges for Artie with his sword. Shrek blocks the blow and Charming lunges at him. Shrek, who at first seems fatally injured, informs Charming that he missed and that the Prince needs to keep looking for his own happily ever after. As Shrek pushes Charming aside, Dragon knocks over Rapunzel's tower, and crushes Charming to death. Shrek tells Artie the throne is his if he wants it. Artie chooses to become king. While the kingdom celebrates, Merlin restores Puss and Donkey to their proper bodies, accidentally switching their tails . Shrek retires with Fiona to their swamp, becoming the parents of ogre triplets.